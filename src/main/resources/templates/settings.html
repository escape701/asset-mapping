<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统设置 - 智能化资产测绘平台</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/settings.css">
</head>
<body>
    <div class="container">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="sidebarHeader">
                <h2>智能化资产测绘平台</h2>
            </div>
            <nav class="sidebarNav">
                <a href="/tasks" class="navItem">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    </svg>
                    <span>首页</span>
                </a>
                <a href="/users" class="navItem">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>用户管理</span>
                </a>
                <a href="/settings" class="navItem active">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    <span>系统设置</span>
                </a>
            </nav>
        </aside>

        <!-- 主内容区 -->
        <main class="mainContent">
            <!-- 顶部导航栏 -->
            <header class="topBar">
                <div class="topBarLeft">
                    <h1>系统设置</h1>
                </div>
                <div class="topBarRight">
                    <div class="userInfo">
                        <span class="userName" id="userName">加载中...</span>
                        <button class="logoutButton" id="logoutButton">退出登录</button>
                    </div>
                </div>
            </header>

            <!-- 内容区域 -->
            <div class="contentArea">
                <!-- 设置导航 -->
                <div class="settingsTabs">
                    <button class="settingsTab active" data-tab="ai">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"></path>
                            <circle cx="7.5" cy="14.5" r="1.5"></circle>
                            <circle cx="16.5" cy="14.5" r="1.5"></circle>
                        </svg>
                        AI 配置
                    </button>
                </div>

                <!-- AI 配置面板 -->
                <div class="settingsPanel" id="aiPanel">
                    <!-- 当前激活配置 -->
                    <div class="settingsCard activeConfigCard">
                        <div class="cardHeader">
                            <h3>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                                当前激活配置
                            </h3>
                        </div>
                        <div class="cardBody" id="activeConfigBody">
                            <div class="noConfig">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                                <p>暂无激活的 AI 配置</p>
                                <span>请先添加并激活一个配置</span>
                            </div>
                        </div>
                    </div>

                    <!-- 配置列表 -->
                    <div class="settingsCard">
                        <div class="cardHeader">
                            <h3>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                </svg>
                                配置列表
                            </h3>
                            <button class="btn btnPrimary" id="addConfigBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                                添加配置
                            </button>
                        </div>
                        <div class="cardBody">
                            <div class="configList" id="configList">
                                <div class="configListEmpty">
                                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="12" y1="8" x2="12" y2="16"></line>
                                        <line x1="8" y1="12" x2="16" y2="12"></line>
                                    </svg>
                                    <p>暂无配置</p>
                                    <span>点击上方按钮添加 AI 配置</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 使用说明 -->
                    <div class="settingsCard helpCard">
                        <div class="cardHeader">
                            <h3>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                                使用说明
                            </h3>
                        </div>
                        <div class="cardBody">
                            <div class="helpContent">
                                <div class="helpItem">
                                    <div class="helpIcon google">G</div>
                                    <div class="helpText">
                                        <strong>Google Gemini</strong>
                                        <p>获取 API Key: <a href="https://aistudio.google.com/apikey" target="_blank">https://aistudio.google.com/apikey</a></p>
                                        <p>推荐模型: gemini-2.0-flash（快速）、gemini-1.5-pro（强推理）</p>
                                    </div>
                                </div>
                                <div class="helpItem">
                                    <div class="helpIcon openai">O</div>
                                    <div class="helpText">
                                        <strong>OpenAI</strong>
                                        <p>获取 API Key: <a href="https://platform.openai.com/api-keys" target="_blank">https://platform.openai.com/api-keys</a></p>
                                        <p>推荐模型: gpt-4o（多模态）、gpt-4o-mini（经济型）</p>
                                    </div>
                                </div>
                                <div class="helpNote">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <line x1="12" y1="16" x2="12" y2="12"></line>
                                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                                    </svg>
                                    <span>配置会同时用于 <strong>登录页面识别</strong>（爬虫截图分析）和 <strong>AI 问答</strong>（结果分析对话）</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 配置编辑模态框 -->
    <div class="modal" id="configModal">
        <div class="modalContent">
            <div class="modalHeader">
                <h3 id="modalTitle">添加 AI 配置</h3>
                <span class="closeButton" id="closeModal">&times;</span>
            </div>
            <form id="configForm" class="modalBody">
                <input type="hidden" id="configId" name="configId">
                
                <div class="formGroup">
                    <label for="configName">配置名称 *</label>
                    <input type="text" id="configName" name="name" placeholder="如：我的 Gemini 配置" required>
                </div>
                
                <div class="formGroup">
                    <label for="configProvider">AI 提供商 *</label>
                    <select id="configProvider" name="provider" required>
                        <option value="">请选择</option>
                        <option value="google">Google Gemini</option>
                        <option value="openai">OpenAI</option>
                    </select>
                </div>
                
                <div class="formGroup">
                    <label for="configModel">模型 *</label>
                    <select id="configModel" name="model" required disabled>
                        <option value="">请先选择提供商</option>
                    </select>
                </div>
                
                <div class="formGroup">
                    <label for="configApiKey">API Key *</label>
                    <div class="inputWithIcon">
                        <input type="password" id="configApiKey" name="apiKey" placeholder="请输入 API Key" required>
                        <button type="button" class="togglePassword" id="toggleApiKey">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                    <span class="formHint" id="apiKeyHint">请输入有效的 API Key</span>
                </div>
            </form>
            <div class="modalFooter">
                <button type="button" class="btn btnOutline" id="testConfigBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                    </svg>
                    测试连接
                </button>
                <div class="footerRight">
                    <button type="button" class="btn btnSecondary" id="cancelBtn">取消</button>
                    <button type="submit" class="btn btnPrimary" id="saveConfigBtn">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 测试结果提示 -->
    <div class="testResultToast" id="testResultToast">
        <div class="toastIcon"></div>
        <div class="toastContent">
            <div class="toastTitle"></div>
            <div class="toastMessage"></div>
        </div>
    </div>

    <script src="/js/common.js"></script>
    <script src="/js/settings.js"></script>
</body>
</html>
